# Massaging Input Data

See repository path `utilities/data-transform` to see 

## Initial Data Format

The initial document provided by our data service provider was in an XML format. The data consisted of an collection of restaurants, each described in this format:

```
<xoi identifier="404290" millesime="2016" type="RESTAURANT" language="eng"> <main_information> <name> <label language="eng">Trading Post</label> </name> <local_name>Trading Post</local_name> <street>170 John St.</street> <postcode>10038</postcode> <address_complement>at South St.</address_complement> <city>New York</city> <main_city>Manhattan</main_city> <state>NY</state> <country>USA</country> <ref_lieu>1156381</ref_lieu> <ref_main>1670351</ref_main> <local_phone1>(646) 370-3337</local_phone1> <int_phone1>+1 646-370-3337</int_phone1> <e164_phone1>+16463703337</e164_phone1> <web>www.tradingpostnyc.com</web> <access mode="subway"> <description>Fulton St</description> </access> </main_information> <geoposition> <lat>40.70594</lat> <lon>-74.00417</lon> </geoposition> <added_values> <data name="michelin_stars" type="criterion"> <value>0</value> </data> <data name="bib_gourmand" type="criterion"> <value>0</value> </data> <data name="rating" type="field"> <value>13</value> </data> <data name="disabled_access" type="criterion"> <value>1</value> </data> <data name="brunch" type="criterion"> <value>0</value> </data> <data name="bring_your_own_bottle" type="criterion"> <value>0</value> </data> <data name="interesting_beer_list" type="criterion"> <value>1</value> </data> <data name="interesting_wine_list" type="criterion"> <value>0</value> </data> <data name="cash_only" type="criterion"> <value>0</value> </data> <data name="classification" type="criterion"> <value>3</value> </data> <data name="cocktail" type="criterion"> <value>0</value> </data> <data name="currency" type="field"> <value>USD</value> </data> <data name="dim_sum" type="criterion"> <value>0</value> </data> <data name="opening_times" type="field"> <value language="eng">Lunch &amp; dinner Mon - Sat</value> </data> <data name="pleasant" type="criterion"> <value>0</value> </data> <data name="michelin_guide_selection" type="criterion"> <value>1</value> </data> <data name="no_smoke" type="criterion"> <value>1</value> </data> <data name="facilities" type="field"> <value>\035 \622 \523</value> </data> <data name="price_class" type="criterion"> <value>5</value> </data> <data name="breakfast" type="criterion"> <value>0</value> </data> <data name="price_max_gm21" type="field"> <value>49.99</value> </data> <data name="price_min_gm21" type="field"> <value>25</value> </data> <data name="meal_price" type="field"> <value>$25 to $50</value> </data> <data name="meals_in_garden" type="criterion"> <value>0</value> </data> <data name="sake" type="criterion"> <value>0</value> </data> <data name="private_room" type="criterion"> <value>1</value> </data> <data name="main_desc" type="field"> <value language="eng">A reprieve from the neighborhood's many pubs and quick-serve joints, this popular restaurant occupies three floors of a historic building across from the Rockwell-designed Imagination Playground. Stylish and eclectic with a maritime theme, the massive space boasts a rollicking bar and whiskey cellar plus an upscale second floor with water views and an elegant library. The menu is just as wonderful and wide-ranging, with everything from flatbreads to skirt steak to lobster fried rice. Highlights include a healthy and delicious quinoa salad, studded with butternut squash, morsels of creamy feta, dried cranberries, and a drizzle of reduced balsamic vinegar. Jumbo shrimp plated with wilted kale, plump butter beans, and braised tomato is an impressive entrée.</value> </data> <data name="cooking_lib" type="multi"> <item> <value language="eng">American</value> </item> </data> <data name="cooking_id" type="multi"> <item> <value>40</value> </item> </data> <data name="restaurant_lib" type="multi"> <item> <value language="eng">restaurant</value> </item> </data> <data name="restaurant_id" type="multi"> <item> <value>1</value> </item> </data> <data name="valet" type="criterion"> <value>0</value> </data> <data name="facilities_details" type="complex"> <data name="disabled_access" type="criterion"> <value>1</value> </data> <data name="private_room" type="criterion"> <value>1</value> </data> </data> <data name="meals_details" type="complex"> <data name="brunch" type="criterion"> <value>0</value> </data> <data name="bring_your_own_bottle" type="criterion"> <value>0</value> </data> <data name="dim_sum" type="criterion"> <value>0</value> </data> <data name="breakfast" type="criterion"> <value>0</value> </data> <data name="sake" type="criterion"> <value>0</value> </data> <data name="cooking_lib" type="multi"> <item> <value language="eng">American</value> </item> </data> <data name="cooking_id" type="multi"> <item> <value>40</value> </item> </data> <data name="restaurant_lib" type="multi"> <item> <value language="eng">restaurant</value> </item> </data> <data name="restaurant_id" type="multi"> <item> <value>1</value> </item> </data> </data> <data name="selections_details" type="complex"> <data name="interesting_beer_list" type="criterion"> <value>1</value> </data> <data name="interesting_wine_list" type="criterion"> <value>0</value> </data> <data name="cocktail" type="criterion"> <value>0</value> </data> <data name="pleasant" type="criterion"> <value>0</value> </data> </data> <data name="credit_cards_details" type="complex"> <data name="cash_only" type="criterion"> <value>0</value> </data> </data> <data name="prices_details" type="complex"> <data name="currency" type="field"> <value>USD</value> </data> <data name="price_class" type="criterion"> <value>5</value> </data> <data name="price_max_gm21" type="field"> <value>49.99</value> </data> <data name="price_min_gm21" type="field"> <value>25</value> </data> </data> <data name="services_details" type="complex"> <data name="no_smoke" type="criterion"> <value>1</value> </data> <data name="meals_in_garden" type="criterion"> <value>0</value> </data> <data name="valet" type="criterion"> <value>0</value> </data> </data> <data name="desc_details" type="complex"> <data name="main_desc" type="field"> <value language="eng">A reprieve from the neighborhood's many pubs and quick-serve joints, this popular restaurant occupies three floors of a historic building across from the Rockwell-designed Imagination Playground. Stylish and eclectic with a maritime theme, the massive space boasts a rollicking bar and whiskey cellar plus an upscale second floor with water views and an elegant library. The menu is just as wonderful and wide-ranging, with everything from flatbreads to skirt steak to lobster fried rice. Highlights include a healthy and delicious quinoa salad, studded with butternut squash, morsels of creamy feta, dried cranberries, and a drizzle of reduced balsamic vinegar. Jumbo shrimp plated with wilted kale, plump butter beans, and braised tomato is an impressive entrée.</value> </data> </data> </added_values> <relationship> <media_relationship/> <xoi_relationship> <xoi identifier="NX70897" type="CITY" role="parent"/> </xoi_relationship> </relationship> </xoi>
```

## Conversion to JSON

XML is painful to manipulate, particularly compared to JSON when using NodeJS. As a first task we built a converter that takes the XML and converts it to JSON.

While there is the useful `xml2js` library, the output from that library is itself not optimal. The structure of the XML leads to repeated data, and the attribute vs content nature of XML leads to a complex JSON data structure. To simplify it down, we wrote a simple node.js script to convert to a flattened JSON format.

Analysis of data quality

